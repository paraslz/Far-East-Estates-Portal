<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Cenderawasih - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Cenderawasih Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "cenderawasih",
                "name": "Ladang Cenderawasih",
                "reportInfo": "Data based on PA Report (August 2025), Agronomy Report (Aug 2025) & Pinfosys Report (Jan 2022). Visit Date: 26th August 2025",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 2,087.40 ha",
                            "Mature: 2,087.40 ha",
                            "Prime Mature: 1,777.70 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD Jul '25 vs Budget)",
                        "value": "11.17 / 12.04 MT",
                        "note": "7.2% below budget"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (YTD Jul '25 vs Budget)",
                        "value": "RM 225.88 / RM 281.41",
                        "note": "20% lower than budget"
                    },
                    "yield_yoy": {
                        "title": "FFB Production (YTD Jul '25 vs '24)",
                        "value": "23,316 / 24,999 MT",
                        "note": "6.7% lower than 2024 YTD"
                    },
                     "pests": {
                        "title": "Pest Status",
                        "value": "High (Rats)",
                        "note": "Infestation persists despite baiting"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656-.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:15 ha (Adequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "High (Rats, Ganoderma)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD '25)", "value": "19.56%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "1.74-2.19 MT/md" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~15 days (Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "N, Mg, K Deficiencies" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan-25", "Feb-25", "Mar-25", "Apr-25", "May-25", "Jun-25", "Jul-25"],
                        "ffb": [3194, 2192, 2663, 2992, 3268, 3839, 5165],
                        "rainfall": [232, 90, 93, 148, 174, 85, 5],
                        "note": "*FFB production and rainfall data for YTD July 2025."
                    },
                    "ageProfile": {
                        "labels": ["Young Prime (2018)", "Prime Mature (2010-2017)"],
                        "data": [14.84, 85.16],
                        "title": "Ladang Cenderawasih - Palm Age Distribution",
                        "note": "*Source: PA Report 2/2025, Pg. 10."
                    }
                },
                "observations": [
                    "<b>High Rat Infestation:</b> Rat damage remains high (>10%) even after baiting. A more intensive campaign with 2 baits/palm is recommended in fields with >20% damage. <span class='observation-ref'>(PAR Pg. 5, 22)</span>",
                    "<b>Delayed 2025 Manuring Program:</b> The application of Mix B fertilizer (May program) is still in progress and only expected to be complete by mid-September, indicating significant delays from the schedule. <span class='observation-ref'>(PAR Pg. 5, 20)</span>",
                    "<b>Nutrient Deficiencies Identified:</b> Foliar analysis from May 2025 indicates declining Nitrogen and Magnesium levels in over 50% of fields, with low Potassium also recorded in several blocks. <span class='observation-ref'>(AR Pg. 6, 29)</span>",
                    "<b>Yield Deficit in 2025:</b> As of July 2025, FFB production is 7.2% below budget and 6.7% lower than the same period in 2024. However, promising fruit set suggests the estate is on track to meet the annual target of 23 MT/ha. <span class='observation-ref'>(PAR Pg. 34, 41)</span>",
                    "<b>Pruning Quality Improved:</b> Pruning standards have notably improved, with most palms having a sufficient number of fronds. However, frond stacking needs improvement, especially in low-lying areas. <span class='observation-ref'>(PAR Pg. 6, 30)</span>",
                    "<b>Ganoderma Management:</b> Soil mounding for Ganoderma-infected palms is ongoing in P10A to prolong their lifespan. Continuous census and marking of affected palms are crucial. <span class='observation-ref'>(PAR Pg. 5, 22)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Overall estate performance is satisfactory. FFB yield for the first 7 months is 11.17 MT/ha, and the estate is on track to meet the annual budget of 23.00 MT/ha. The ex-estate cost of production (RM 225.88/ton) is well below budget. Key challenges include delays in the fertilizer program and high rat infestation. (Source: PAR, Pg. 41)",
                        "Area Statement": "Total planted area is 2,087.40 ha, all mature. The age profile consists of 14.84% young prime (309.70 ha) and 85.16% prime mature (1,770.70 ha). Construction of cambered bunds for planting on 7.60 ha of vacant land is underway. (Source: PAR, Pg. 10)",
                        "Labour Statement": "The estate has 136 workers, giving a ratio of 1 worker to 15 ha, which is considered adequate. 20 new quotas for Indonesian workers have been secured to address shortages, with arrivals expected from September. (Source: PAR, Pg. 12-13)",
                        "Staff Establishment": "The staff complement is sufficient. There were several staff movements in early 2025, including a new Manager, Assistant Manager, and Supervisor. (Source: PAR, Pg. 14-15)",
                        "General Charges": "The YTD cost for General Charges was RM 658.22/ha, 26% lower than budget. The expenditure was well-managed. (Source: PAR, Pg. 16)",
                        "Upkeep and Cultivation": "Weeding is satisfactory. Manuring is delayed, with the May program still ongoing. Rat baiting was completed, but infestation remains high. Road grading is complete, and drain desilting is progressing. Pruning quality has improved significantly. (Source: PAR, Pg. 18-31)",
                        "Harvesting and Collection": "The harvesting standard is satisfactory, with an average interval of 15 days. The YTD cost is RM 82.44/tonne, which is 4% below budget. Improvement is needed in frond stacking. (Source: PAR, Pg. 32-33)",
                        "Crop Production": "YTD FFB production is 23,316.76 tons, which is 92.8% of budget. The fruit set is promising, and the estate is on track to meet its annual target. (Source: PAR, Pg. 34)",
                        "Production Cost": "The YTD ex-estate cost per tonne is RM 225.88, which is 20% lower than the budget of RM 281.41. (Source: PAR, Pg. 37)",
                        "Vehicles Running Cost": "Vehicle running costs are generally acceptable, though one tractor had a major overhaul. (Source: PAR, Pg. 39)",
                        "Capital Expenditure": "CAPEX is progressing as scheduled, though construction of new Labour Quarters is pending approval and will be carried forward. (Source: PAR, Pg. 40)"
                    },
                    "agronomy": {
                        "Executive Summary": "Yield as of July 2025 is 7% lower than 2024. The manuring program is behind schedule due to stock delays. Rat infestation remains a major concern despite baiting. Foliar analysis reveals N, Mg, and K deficiencies. Ganoderma infection was noted in P10A. (Source: AR, Pg. 4-7)",
                        "Nutrient Inputs/Progress of Manuring": "As of July 2025, the manuring program is 41% complete, delayed by fertilizer stock and delivery issues. Mixture B application is at 38% and Rock Phosphate is at 56%. Inconsistent application quality was noted in P10A7. (Source: AR, Pg. 14-16)",
                        "Agronomic Observation": "Harvesting intervals are slightly extended but acceptable. Canopy management is generally good, but premature frond snapping due to water stress was observed in P10A. Rat infestation is high. Ground vegetation control is satisfactory. Ganoderma has been detected in P10A, with mounding and deboling implemented. (Source: AR, Pg. 20-43)",
                        "Yield Performance": "As of July 2025, the estate's yield is 11.16 mt/ha, a 7% deficit compared to the same period in 2024. Block P10A recorded the largest deficit (-21%), while P18H showed improvement (+21%). Production is expected to increase in Q3. (Source: AR, Pg. 47, 49)",
                        "Fertilizer Recommendation": "The 2026 fertilizer program has been prepared. It recommends Mixture A and B as the main nutrient sources, with Rock Phosphate as an alternative P source. Dosages are reduced for blocks receiving EFB. (Source: AR, Pg. 50)"
                    },
                    "pinfosys": {
                        "CEO Financial Summary (Jan 2022)": "Total Income: RM 2,128,529.12<br>Estate Operating Profit: RM 1,674,787.30<br>Profit Margin: 78.7%<br>Net Current Assets: RM 21,692,955.71<br><span class='text-xs'>(Source: Pinfosys, Pg. 4, 136)</span>",
                        "Summary of Oil Palm Expenditure (Jan 2022)": [
                            { "item": "<strong>Upkeep & Cultivation</strong>", "cost_ha": "<strong>62.47</strong>", "cost_tonne": "<strong>63.31</strong>" },
                            { "item": "&nbsp;&nbsp;&nbsp;Weeding", "cost_ha": "6.97", "cost_tonne": "7.08" },
                            { "item": "&nbsp;&nbsp;&nbsp;Manuring", "cost_ha": "46.05", "cost_tonne": "46.77" },
                            { "item": "&nbsp;&nbsp;&nbsp;Pest & Disease", "cost_ha": "0.72", "cost_tonne": "0.73" },
                            { "item": "&nbsp;&nbsp;&nbsp;Census & Thinning Out", "cost_ha": "0.50", "cost_tonne": "0.51" },
                            { "item": "&nbsp;&nbsp;&nbsp;Drains", "cost_ha": "0.05", "cost_tonne": "0.05" },
                            { "item": "&nbsp;&nbsp;&nbsp;Roads & Bridges", "cost_ha": "4.06", "cost_tonne": "4.13" },
                            { "item": "&nbsp;&nbsp;&nbsp;Pruning", "cost_ha": "0.91", "cost_tonne": "0.92" },
                            { "item": "<strong>Harvesting & Collection</strong>", "cost_ha": "<strong>81.68</strong>", "cost_tonne": "<strong>82.78</strong>" },
                            { "item": "&nbsp;&nbsp;&nbsp;Harvesting Labour", "cost_ha": "62.08", "cost_tonne": "62.99" },
                            { "item": "&nbsp;&nbsp;&nbsp;Internal Transport", "cost_ha": "20.70", "cost_tonne": "20.99" },
                            { "item": "<strong>General Charges (Prop.)</strong>", "cost_ha": "<strong>41.94</strong>", "cost_tonne": "<strong>42.50</strong>" },
                            { "item": "<strong>Total Estate Expenditure</strong>", "cost_ha": "<strong>186.09</strong>", "cost_tonne": "<strong>188.60</strong>" }
                        ]
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-02b:</b> If post-baiting census still indicates damage >10%, a second round of baiting must be conducted within 30 days.</p></div> <div class='policy-item'><p class='font-semibold'>Manuring & Fertilizing</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-05:</b> All fertilizer applications must be completed according to the schedule. Any delays beyond 15 days must be reported with a mitigation plan.</p></div> <div class='policy-item'><p class='font-semibold'>Pruning & Harvesting</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-02:</b> Harvesting intervals should not exceed 15 days to minimize over-ripe bunches and loose fruit loss.</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-FROND-04:</b> In palms younger than 8 years, a minimum of 2 subtending fronds must be retained below the lowest bunch to prevent over-pruning.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield/Ha') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('FFB Production') ? 'bg-yellow-50 text-yellow-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' : 'bg-red-50 text-red-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div class="chart-container"><h3 class="text-xl font-semibold mb-2 text-center">Monthly Production vs Rainfall (YTD 2025)</h3><canvas id="prodChart-${estate.id}"></canvas><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div class="chart-container"><h3 class="text-xl font-semibold mb-2 text-center">Palm Age Profile</h3><canvas id="ageChart-${estate.id}"></canvas><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#eab308'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 14 } }, legend: { position: 'bottom' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (pinfosysDiv && estateData.reports.pinfosys) {
                    let pinfosysHTML = '';
                    for (const [section, content] of Object.entries(estateData.reports.pinfosys)) {
                        pinfosysHTML += `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4>`;
                        if (Array.isArray(content)) {
                            pinfosysHTML += `
                                <div class="overflow-x-auto">
                                    <table class="min-w-full bg-white text-sm mt-2">
                                        <thead class="bg-gray-200">
                                            <tr>
                                                <th class="px-4 py-2 text-left">Expenditure Item</th>
                                                <th class="px-4 py-2 text-right">Cost / Hectare (RM)</th>
                                                <th class="px-4 py-2 text-right">Cost / Tonne (RM)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${content.map(row => `
                                                <tr class="border-b">
                                                    <td class="px-4 py-2">${row.item}</td>
                                                    <td class="px-4 py-2 text-right">${row.cost_ha}</td>
                                                    <td class="px-4 py-2 text-right">${row.cost_tonne}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                    <p class="text-xs text-gray-500 mt-1 italic">Source: Pinfosys Report, Jan 2022, Pg. 173</p>
                                </div>`;
                        } else {
                            pinfosysHTML += `<p class="text-sm text-gray-600">${content}</p>`;
                        }
                    }
                    pinfosysDiv.innerHTML = pinfosysHTML;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = estateData.policy;
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateData.name}`;
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
