<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Dawn - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Dawn Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "dawn",
                "name": "Ladang Dawn",
                "reportInfo": "Data based on PA Report (Oct 2025) & Agronomy Report (Oct 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,776.92 ha",
                            "Mature: 1,751.42 ha",
                            "Immature: 0.00 ha",
                            "Nursery: 25.50 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "19.90 / 15.45 MT",
                        "note": "YTD Sep '25"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "RM 207.71 / RM 292.96",
                        "note": "Ex-Estate, YTD Sep '25"
                    },
                    "pruning": {
                        "title": "Pruning Status",
                        "value": "Unsatisfactory",
                        "note": "Backlog in Tall Palms (P03C, P00A)"
                    },
                     "pests": {
                        "title": "Pest Status",
                        "value": "Rats (>10%)",
                        "note": "High damage recorded; Baiting Nov '25"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:23 ha (Harvesters)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "High (Rats >10%)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (CPO)", "value": "18.93%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "~2.92 MT/md (Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "12-20 days (Target <15)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "92% Done (Lumpy App)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep"],
                        "ffb": [3500, 3200, 3600, 4100, 4300, 3900, 3800, 4038, 4100], // Estimated based on trend
                        "rainfall": [161.5, 82.0, 146.0, 249.5, 170.1, 84.5, 2.5, 116.5, 143.0],
                        "note": "*Rainfall 2025 actuals (AR Appendix 3); FFB trend estimated."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Years", "4-7 Years", "8-19 Years", "20-25 Years", ">26 Years"],
                        "data": [0.0, 12.7, 53.2, 34.0, 0.0],
                        "title": "Ladang Dawn - Palm Age Distribution (2025)",
                        "note": "*Source: Agronomy Report 2/2025, Pg. 10."
                    }
                },
                "observations": [
                    "<b>Rat Infestation:</b> Rat damage census in June 2025 exceeded 10% threshold in most blocks. Baiting campaign is planned for November 2025. <span class='observation-ref'>(AR Pg. 6, 41)</span>",
                    "<b>Fertilizer Application Issues:</b> Lumpy application observed in P15D1 due to uneven broadcasting. Fertilizer store found untidy with spillage. Overall program is 92% complete but slightly delayed. <span class='observation-ref'>(AR Pg. 16-17)</span>",
                    "<b>Pruning Backlog:</b> Pruning in tall palms (P03C4, C5, P00A4) is unsatisfactory with dry hanging fronds. Improved standards noted in roadside palms. <span class='observation-ref'>(AR Pg. 31-33)</span>",
                    "<b>Harvesting Standards:</b> Most fields harvested at <20 days, but target is 15 days. Overripe bunches (5-10%) observed in P16F2, P12H3, and P03C4. <span class='observation-ref'>(AR Pg. 5, 23)</span>",
                    "<b>Drainage & Flooding:</b> Block P12M (40% of area) is prone to prolonged flooding. Cambered bunds in sandy areas (P21L) are unstable and require mounding. <span class='observation-ref'>(AR Pg. 43, 47)</span>",
                    "<b>Weed Control:</b> Localized patches of aggressive weeds (Clidemia, Tetracera) found in P12H1 and P15D5. Volunteer Oil Palms (VOPs) found in P15D3. <span class='observation-ref'>(AR Pg. 38-39)</span>",
                    "<b>Plantation Advisory Note (Roads):</b> Road maintenance is critical; laterite work planned for the year has not been carried out. <span class='observation-ref'>(PAR Pg. 23)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance is acceptable with FFB production 28% higher than budget and costs 29% lower. However, significant backlogs in pruning and manuring need immediate attention. (Source: PAR Pg. 47-49)",
                        "Area Statement": "Total planted area is 1,762.32 ha. Age profile: 33.85% Old Mature, 52.16% Prime Mature, 12.68% Young Mature, 1.31% Immature. (Source: PAR Pg. 10)",
                        "Labour Statement": "Total workforce is 137 (Shortage of 4). Harvester ratio is 1:23 ha, which is deemed adequate. (Source: PAR Pg. 12)",
                        "Staff Establishment": "Staffing is satisfactory. One Conductor vacancy exists. (Source: PAR Pg. 14)",
                        "General Charges": "YTD expenditure is RM 1,102.81/ha, 19% lower than budget. Overspending noted in Medical and Leave Pay. (Source: PAR Pg. 16)",
                        "Upkeep and Cultivation": "Weeding behind schedule in P16F. Road grading 95% complete but lateriting is untouched. Pruning backlog in P00A/B/C is critical. Manuring is delayed. (Source: PAR Pg. 18-32)",
                        "Harvesting and Collection": "Interval is 15 days. Loose fruit recovery gangs are deployed. Harvester productivity (Timac: 2.90T, Crawler: 2.94T) can be improved. (Source: PAR Pg. 33-38)",
                        "Crop Production": "YTD FFB: 34,538 MT (28% above budget). Yield: 19.86 MT/ha. (Source: PAR Pg. 36)",
                        "Production Cost": "Ex-estate cost is RM 207.71/MT, 29% lower than budget due to higher crop production. (Source: PAR Pg. 40)",
                        "Vehicles": "Running costs generally acceptable. Timac 02 is under-utilized. (Source: PAR Pg. 46)",
                        "Capital Expenditure": "Includes Tube Well construction and office equipment purchases. (Source: PAR Pg. 44)",
                        "Immature": "23 ha in Ladang Kampong Aur to be declared mature Jan 2026. (Source: PAR Pg. 10)"
                    },
                    "agronomy": {
                        "Executive Summary": "The agronomy visit on 27th October 2025 (Report No: 2/2025) highlighted that while 2024 yield performance was satisfactory (26.9 MT/Ha), several operational issues require immediate rectification. Key concerns include a rat damage census exceeding the 10% threshold, unsatisfactory pruning in tall palm areas (P03C, P00A), and inconsistent fertilizer application quality. 2025 YTD yield (Sep) stands at 19.9 MT/Ha. (Source: AR Pg. 2-7, 45)",
                        "Nutrient Inputs & Manuring": "The 2024 fertilizer program was completed with minor delays. As of September 2025, the current program is 92% complete. However, field inspections revealed 'lumpy' fertilizer application in Block P15D1 due to uneven broadcasting and application too close to the palm base. The fertilizer store conditions were untidy with visible spillage and broken pallets. EFB application covers 16% of the area but remains inconsistent in quality. Recommendation: Utilize frond stacks for fertilizer placement on sandy soils to improve nutrient retention. (Source: AR Pg. 16-19)",
                        "Agronomic Observation (Mature)": "<b>Harvesting:</b> Intervals are currently 12-20 days; target is <15 days. Overripe bunches (5-10%) were detected in P16F2, P12H3, P15D3, and P03C4. <br><b>Pruning:</b> Generally satisfactory, but significant backlogs with dry hanging fronds persist in tall palm blocks P03C and P00A. <br><b>Weeding:</b> Ground cover is acceptable, but localized patches of <i>Clidemia hirta</i> and <i>Tetracera indica</i> were found in P12H1 and P15D5. Volunteer Oil Palms (VOPs) in P15D3 require removal. <br><b>Pests:</b> Rat damage census (June 2025) exceeded 10% in most blocks. A baiting campaign is scheduled for Nov 2025. Barn owl box occupancy is excellent at 97%. (Source: AR Pg. 23, 31, 38, 41-42)",
                        "Agronomic Observation (Young Mature)": "<b>Infrastructure:</b> In Block P21L (Sandy), excessive high cambered bunds have caused palms to lean; mounding with clayey soil is recommended. In P19J (Clay/Silt), the current field drain system is less effective; construction of cambered bunds is advised to improve drainage efficiency. (Source: AR Pg. 43-44)",
                        "Yield Performance": "<b>Trend:</b> Yield increased from 20.68 MT/Ha (2023) to 26.9 MT/Ha (2024). YTD Sept 2025 yield is 19.9 MT/Ha. <br><b>Limiting Factors:</b> Flood-prone areas cover 118.29 Ha (approx 6.75% of estate), specifically affecting Block P12M (40% flooded) and P16F (51% flooded). Prolonged inundation in P12M requires drainage improvements (desilting). <br><b>Contribution:</b> Young mature blocks P19J, P20K, and P21L are in the ascending yield phase, stabilizing estate performance. (Source: AR Pg. 45-47)",
                        "Fertilizer Recommendation": "The 2026 fertilizer program has been provided (Appendix 1a-c). The estate is urged to minimize the gap between the scheduled program and actual application. Specific attention must be paid to applying fertilizers on frond heaps in sandy areas to maximize Cation-Exchange Capacity (CEC). (Source: AR Pg. 50)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pruning & Canopy Management</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-OLD-01:</b> Pruning backlogs in old mature areas must be cleared to improve harvesting efficiency and prevent crop loss.</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-01:</b> Over-pruning of roadside palms must be avoided. Pruning should only be done to improve visibility and safety, not at the expense of palm health.</p></div> <div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-02a:</b> A strategic baiting program must be implemented when damage exceeds 5%. Census must cover >10% of the area.</p></div> <div class='policy-item'><p class='font-semibold'>Fertilizer Application</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-01:</b> Supervisors must ensure even broadcasting of fertilizers. Lumpy or narrow-band applications are unacceptable and reduce nutrient uptake.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Pruning') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT) (Est)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#22c55e', '#eab308', '#ca8a04', '#a16207', '#713f12'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (pinfosysDiv) {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">${estateData.reports.pinfosys}</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = ` <div class='policy-item'><p class='font-semibold'>Pruning & Canopy Management</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-OLD-01:</b> Pruning backlogs in old mature areas must be cleared to improve harvesting efficiency and prevent crop loss.</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-01:</b> Over-pruning of roadside palms must be avoided. Pruning should only be done to improve visibility and safety, not at the expense of palm health.</p></div> <div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-02a:</b> A strategic baiting program must be implemented when damage exceeds 5%. Census must cover >10% of the area.</p></div> <div class='policy-item'><p class='font-semibold'>Fertilizer Application</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-01:</b> Supervisors must ensure even broadcasting of fertilizers. Lumpy or narrow-band applications are unacceptable and reduce nutrient uptake.</p></div>`;
            modalTitle.innerText = 'Agricultural Policy Cross-Reference: Ladang Dawn';
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
