<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Sungai Batu - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="../index.html" class="flex items-center">
                    Ladang Sungai Batu Report
                </a>
            </div>
            <a href="../estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             </div>
    </div>
    
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "sgbatu",
                "name": "Ladang Sungai Batu",
                "reportInfo": "Visit Date: 28th May 2025. Data based on Plantation Advisory Report 1/2025 and Agronomy Report 2/2024.",
                "summaryMetrics": {
                    "area": {
                        "title": "Total Area",
                        "value": "890.90 ha",
                        "note": "886.80 ha planted (mature)"
                    },
                    "yield": {
                        "title": "Yield/Ha vs Budget (YTD Apr)",
                        "value": "6.50 / 6.08 MT",
                        "note": "+7% above budget"
                    },
                    "cost": {
                        "title": "Cost/Tonne vs Budget (YTD Apr)",
                        "value": "RM 244.92",
                        "note": "-21% below budget"
                    },
                    "pests": {
                        "title": "Key Pest & Disease Issue",
                        "value": "Ganoderma",
                        "note": "Symptoms found in P05A, P06B, P07C"
                    },
                    "upkeep": {
                        "title": "Key Upkeep Issue",
                        "value": "Delayed Programs",
                        "note": "Weeding & Manuring behind schedule"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1 : 13 ha (Adequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Ganoderma Detected" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "Harvester Prod.", "value": "1.69 MT/manday (Low)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Crop Recovery", "value": "Acceptable (AR)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~15 days (Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Suboptimal (Low P & Mg) (AR)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr"],
                        "ffb": [5760.75], // Cumulative FFB YTD April from PAR
                        "rainfall": [229, 113, 173, 226], // Monthly rainfall from PAR
                        "note": "*Rainfall data from Jan-Apr 2025 (PAR). FFB production is shown as a cumulative YTD April 2025 figure as monthly breakdown was not available in the PA report."
                    },
                    "ageProfile": {
                        "labels": ["Old Mature (>=19Y)", "Prime Mature (13-18Y)"],
                        "data": [412.1, 474.7],
                        "title": "Ladang Sungai Batu - Palm Age Distribution (886.80 ha)",
                        "note": "*Based on 46.47% Old Mature & 53.53% Prime Mature palms (PAR Pg. 9)."
                    }
                },
                "observations": [
                    "<b>Positive Financials and Yield:</b> Yield per hectare is 7% higher than budget, and FFB cost of production is 21% lower than budget, which is highly favorable. <span class='observation-ref'>(PAR Pg. 6, 7, 37, 40)</span>",
                    "<b>Delayed Field Work:</b> Both weeding (circle and selective spraying) and manuring programs are behind schedule. Manuring delays are attributed to late fertilizer delivery. <span class='observation-ref'>(PAR Pg. 4, 5, 16, 28)</span>",
                    "<b>Ganoderma Presence:</b> Symptoms of Ganoderma infection were identified in blocks P05A, P06B, and P07C, requiring monitoring and action. <span class='observation-ref'>(PAR Pg. 5)</span>",
                    "<b>Low Harvester Productivity:</b> Despite acceptable yield, the average harvester productivity is low at only 1.69 tons per man-day, which needs investigation. <span class='observation-ref'>(PAR Pg. 6)</span>",
                    "<b>Pruning Quality Needs Improvement:</b> While progressive pruning is ongoing, quality needs to be enhanced. Issues include dried hanging fronds in all fields and under-pruned small palms. <span class='observation-ref'>(PAR Pg. 5, 29)</span>",
                    "<b>Messy Ground Conditions:</b> Patches of noxious weeds, VOPs, and overgrown creepers were noted. Dirty palm circles with debris were also found, which can hinder loose fruit collection. <span class='observation-ref'>(PAR Pg. 17-19)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate's performance is acceptable. FFB production is higher than budget, and the cost of production is lower. However, the progress of weeding and manuring programs is slightly behind schedule. Harvesting standards have improved since the last visit. <span class='observation-ref'>(PAR Pg. 43)</span>",
                        "Area Statement": "Total planted area is 886.80 ha, all of which is mature. The age profile consists of 46.47% 'Old Mature Palms' (>=19 years) and 53.53% 'Prime Mature Palms'. The youngest palms are 13 years old. <span class='observation-ref'>(PAR Pg. 9)</span>",
                        "Labour Statement": "The total labour force of 67 workers is considered adequate, with a ratio of one worker to 13 ha. The harvester strength is also adequate at one harvester to 19 ha. The workforce is composed of 24% check-roll and 76% contract workers. <span class='observation-ref'>(PAR Pg. 10)</span>",
                        "Staff Establishment": "There has been no change in the staff establishment since the last visit, and the current complement is satisfactory. <span class='observation-ref'>(PAR Pg. 12)</span>",
                        "General Charges": "As of April, the expenditure on General Charges was RM 324.04/ha, which is 47% lower than the budget. <span class='observation-ref'>(PAR Pg. 13)</span>",
                        "Upkeep and Cultivation": "Total upkeep cost was RM 379.76/ha, 51% lower than budget. Weeding programs are delayed. Manuring is behind schedule due to late fertilizer delivery. Pruning quality needs improvement. Ganoderma symptoms were observed. <span class='observation-ref'>(PAR Pg. 16, 28, 29)</span>",
                        "Harvesting and Collection": "Harvesting intervals were maintained at 15 days, and the standard was acceptable with negligible missed fruits and bunches. The cost of harvesting and collection was RM 77.80/tonne, 4% lower than budget. <span class='observation-ref'>(PAR Pg. 33, 41)</span>",
                        "Crop Production": "YTD FFB production as of April was 5,760.75 tonnes (6.50 t/ha), which is 7% higher than the budget of 5,388.00 tonnes (6.08 t/ha). <span class='observation-ref'>(PAR Pg. 37)</span>",
                        "Production Cost": "The FFB cost of production ex-estate as of April was RM 244.92/tonne, which is 21% lower than the budget of RM 310.12/tonne. <span class='observation-ref'>(PAR Pg. 40)</span>",
                        "Vehicles Running Cost": "Running cost for the Generator set was 19% higher than budget, and the water pump was 115% higher than budget due to repairs. <span class='observation-ref'>(PAR Pg. 42)</span>",
                        "Capital Expenditure": "Capital expenditure is acceptable. <span class='observation-ref'>(PAR Pg. 7)</span>",
                        "Immature": "Not applicable as all areas are mature."
                    },
                    "agronomy": { // This data is preserved from the previous file
                        "Executive Summary": "The estate's agronomic condition is acceptable with very encouraging yield performance in 2024. Crop recovery is good and pest populations are under control. Key areas for improvement are the quality of pruning and the eradication of remaining undesirable weeds. (Source: AR, Pg. 4-5, 30-31)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 manuring program is 69% complete as of August, which is acceptable. The quality of application observed was good. (Source: AR, Pg. 9-10)",
                        "Agronomic Observation": "Harvesting intervals are well-maintained at ~15 days. Pruning is 68% complete but quality needs to improve. Palm appearance is acceptable, though some K deficiency is noted in P05A. Ground vegetation is satisfactory, but some VOPs and noxious weeds need eradication. Rat population is under control. (Source: AR, Pg. 11-28)",
                        "Yield Performance": "Yield as of August 2024 is 14.95 mt/ha, a 44.4% increase from 2023. The performance is satisfactory and all fields are expected to meet their targets. (Source: AR, Pg. 29-31)",
                        "Fertilizer Recommendation": "The 2025 fertilizer program has been formulated to address nutrient deficiencies identified in the foliar analysis. (Source: AR, Pg. 32)"
                    },
                     "pinfosys": {
                        "CEO-Level Summary": "Not Available (Pinfosys report was not provided).",
                        "Expenditure Breakdown": "Not Available"
                    }
                },
                "policy": "<div class='policy-item'><p class='font-semibold'>Weed Management</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-VOP-01:</b> All Volunteer Oil Palms (VOPs), noxious weeds, and jungle creepers must be eradicated to prevent competition and disease spread, especially in open and isolated areas. <span class='observation-ref'>(PAR Pg. 19)</span></p></div> <div class='policy-item'><p class='font-semibold'>Pruning Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-02:</b> All productive palms, including smaller ones, must be pruned appropriately to ensure complete harvesting of ripe bunches. Dried and hanging fronds must be removed. <span class='observation-ref'>(PAR Pg. 29)</span></p></div> <div class='policy-item'><p class='font-semibold'>Pest & Disease Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-GANO-01:</b> Any palms showing symptoms of Ganoderma infection must be monitored. Severely infected palms must be de-boled immediately to prevent further spread. <span class='observation-ref'>(PAR Pg. 5)</span></p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' :
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-emerald-50 text-emerald-800' :
                                       metric.title.includes('Upkeep') ? 'bg-orange-50 text-orange-800' : 'bg-red-50 text-red-800';
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'Cumulative FFB (MT)', data: [0,0,0, ...estateData.chartData.production.ffb], type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.1, fill: false },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' }, suggestedMin: 0 }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false }, suggestedMin: 0 } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#f97316', '#3b82f6'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                Object.keys(estateData.reports).forEach(reportType => {
                    const div = document.getElementById(`${estateData.id}-${reportType}`);
                    if (div && estateData.reports[reportType]) {
                        div.innerHTML = Object.entries(estateData.reports[reportType]).map(([section, content]) => {
                           const formattedSection = section.replace(/([A-Z])/g, ' $1').trim();
                           return `<h4 class="font-semibold mt-2 text-gray-800">${formattedSection}:</h4><p class="text-sm text-gray-600">${content}</p>`
                        }).join('');
                    }
                });
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
