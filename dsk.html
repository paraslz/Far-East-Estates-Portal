<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang DSK - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang DSK Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "dsk",
                "name": "Ladang DSK",
                "visitDate": "9th July 2025",
                "reportInfo": "Data based on Plantation Advisory Report (July 2025) & Agronomy Report (Q1 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,320.30 ha",
                            "Mature: 1,320.30 ha",
                            "Prime Mature: 100%"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD June '25 vs Budget)",
                        "value": "9.55 / 9.39 MT",
                        "note": "+1.7% vs budget"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (YTD June '25 vs Budget)",
                        "value": "RM 274.43 / RM 344.00",
                        "note": "20% lower than budget"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Adequate",
                        "note": "1:15 ha ratio"
                    },
                     "pests": {
                        "title": "Pest Status",
                        "value": "Moderate",
                        "note": "Rat & Elephant damage controlled"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 13a5.975 5.975 0 01-3 5.197z' /></svg>", "label": "Labour Ratio", "value": "1:15 ha (Adequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Moderate (Rats, Elephants)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD June '25)", "value": "19.19%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "~2.4 MT/md (Good)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "12-15 days" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636' /></svg>", "label": "Manuring Status", "value": "Delayed" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["2021", "2022", "2023", "2024", "YTD Jun '25"],
                        "ffb": [15.83, 18.74, 15.24, 22.76, 9.55],
                        "rainfall": [1916.0, 2266.5, 2802.5, 2548.0, 1488.0]
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature Palms (9-13 years)"],
                        "data": [100],
                        "title": "Ladang DSK - Palm Age Distribution",
                        "note": "Source: PAR 2/2025, Pg. 10"
                    }
                },
                "observations": [
                    "<b>Weed Management:</b> While general weeding is satisfactory, noxious weeds like woodies and ferns persist in many fields and require targeted eradication. <span class='observation-ref'>(PAR Pg. 5, 20)</span>",
                    "<b>Road & Infrastructure:</b> Severe erosion on roads in hilly areas is still a major concern. Road grading and raising are in progress, but a systematic approach to water diversion is needed. <span class='observation-ref'>(PAR Pg. 5, 26-27, 43)</span>",
                    "<b>Delayed Manuring:</b> Fertiliser application programs are delayed due to incomplete delivery. The estate must accelerate applications once supply resumes to avoid impacting palm health. <span class='observation-ref'>(PAR Pg. 5, 21, 42)</span>",
                    "<b>Pest Control:</b> Although fresh rat damage is below the threshold post-baiting, symptoms of old damage are widespread. Elephant intrusion also requires ongoing vigilance and boundary maintenance. <span class='observation-ref'>(PAR Pg. 6, 23, 43)</span>",
                    "<b>Harvesting & Pruning Standards:</b> Over-pruning was observed in most fields, which can cause palm stress. The estate must retrain harvesters on correct pruning standards. <span class='observation-ref'>(PAR Pg. 6, 30, 44)</span>",
                    "<b>Mechanisation & Productivity:</b> Harvester productivity could be significantly improved by widening planting terraces to allow better machine access for in-field FFB collection. <span class='observation-ref'>(PAR Pg. 7, 35, 44)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance in H1 2025 was satisfactory. FFB production (12,608.98 MT) slightly exceeded budget at a cost 20% lower than budget (RM 274.43/T). The estate has potential to surpass its annual yield target. Key challenges include delayed fertilizer application, persistent noxious weeds, severe road erosion in hilly areas, and the need to improve harvester/machine productivity by widening terraces. Over-pruning is an issue requiring training. Pest control for rats and elephants is ongoing and largely effective. <span class='observation-ref'>(PAR Pg. 42-44)</span>",
                        "Area Statement": "Total planted area is 1,320.30 ha, all of which are prime mature palms (planted 2012-2016). The terrain is challenging, with 48% hilly ground, 37% low-lying, and 15% flat/undulating, presenting issues with water management and elephant intrusion. <span class='observation-ref'>(PAR Pg. 10)</span>",
                        "Labour Statement": "The labour force of 90 workers is adequate, with a man-to-land ratio of 1:15. There is a current shortage of 5 workers, but workers on leave are expected to return. The harvester-to-land ratio is 1:24 ha. <span class='observation-ref'>(PAR Pg. 12-13)</span>",
                        "Staff Establishment": "The executive and staff complement is adequate. A new Officer In-Charge was transferred to the estate on March 1, 2025. <span class='observation-ref'>(PAR Pg. 14)</span>",
                        "General Charges": "YTD expenditure is RM 680.90/ha, 24% below budget. Overspending was noted in Medical, Electricity, and Water due to various factors, and these require monitoring for potential additional budget applications. <span class='observation-ref'>(PAR Pg. 15-17)</span>",
                        "Upkeep and Cultivation": "Weeding cost is 21% below budget due to delays. Circle spraying is 66% complete. Manuring is delayed due to supply issues. P&D costs are 8% below budget, with rat baiting completed and elephant intrusion being managed. Road maintenance is ongoing but spending is 29% below budget. <span class='observation-ref'>(PAR Pg. 18-30)</span>",
                        "Harvesting and Collection": "The harvesting interval is maintained at 12-15 days with good quality FFB. The cost of RM 100.28/tonne is slightly above budget due to higher external transport costs to Merchong Oil Mill. <span class='observation-ref'>(PAR Pg. 31-32)</span>",
                        "Crop Production": "YTD FFB production is 12,608.98 tonnes, which is 1.7% above budget. The YTD yield is 9.55 t/ha. With a good fruit set, the estate expects to achieve a full-year yield of nearly 24 t/ha. <span class='observation-ref'>(PAR Pg. 33)</span>",
                        "Production Cost": "The ex-estate cost of production as of June was RM 274.43 per tonne, 20% lower than budget, mainly due to lower upkeep costs from delayed manuring. <span class='observation-ref'>(PAR Pg. 37-38)</span>",
                        "Vehicles Running Cost": "Running costs for the Hilux, New Holland tractor, and Van Higer are all within or below budget. The vehicles are in good physical condition. <span class='observation-ref'>(PAR Pg. 41)</span>",
                        "Capital Expenditure": "Total spent is RM 14,000 out of a RM 724,500 budget. Key projects like labour quarters construction have been awarded, while others are in progress or deferred. <span class='observation-ref'>(PAR Pg. 39-40)</span>",
                        "Immature": "Not Applicable."
                    },
                    "agronomy": {
                        "Executive Summary": "The estate's agronomic condition is acceptable, but key challenges remain. Rat infestation is still above the threshold despite baiting. Ground vegetation is unsatisfactory with bare patches and undesirable weeds. Palms in flood-prone areas show poor health. (Source: AR, Pg. 4-5)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 manuring program was completed, though with delays up to 5 months for RP. The fertilizer store has wet floor conditions needing repair. (Source: AR, Pg. 11-12)",
                        "Agronomic Observation": "Harvesting standards are acceptable. Pruning is acceptable. Palm appearance varies, with poor vigour in flood-prone and lateritic soil areas. Rat damage is high. Elephant damage was noted in P16F. (Source: AR, Pg. 25-49)",
                        "Yield Performance": "Yield increased by 49% in 2024 to 22.76 mt/ha. The average bunch weight and number of bunches per palm increased. (Source: AR, Pg. 50-52)",
                        "Fertilizer Recommendation": "The 2025 program is detailed. Site-specific fertilizer placement is recommended for terraced and low-lying areas to minimize nutrient loss. (Source: AR, Pg. 14-15, 53)"
                    },
                     "pinfosys": {
                        "summary": "Not Available."
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-02b:</b> If post-baiting census shows damage still exceeds 10%, review bait palatability and re-implement the baiting campaign following a systematic, single-direction approach.</p></div> <div class='policy-item'><p class='font-semibold'>Ground Vegetation & Weeding</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-04:</b> In areas with bare ground, encourage the establishment of soft grasses and minimize herbicide use to prevent further soil degradation and erosion.</p></div> <div class='policy-item'><p class='font-semibold'>Infrastructure Maintenance</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-ROAD-03:</b> On hilly terrain, construct and maintain adequate roadside sumps and run-off drains to prevent erosion of the road surface.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Labour') ? 'bg-purple-50 text-purple-800' : 'bg-red-50 text-red-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-1 text-gray-900">${estate.name}</h2>
                        <p class="text-md text-gray-600 mb-2">Plantation Advisory Visit: ${estate.visitDate}</p>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">FFB Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">Source: PAR 2/2025, Pg. 50, 51</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Yield (MT/Ha)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Yield (MT/Ha)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#16a34a', '#facc15', '#ef4444'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'bottom' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                Object.keys(estateData.reports).forEach(reportType => {
                    const div = document.getElementById(`${estateData.id}-${reportType}`);
                    if (div) {
                        const reportData = estateData.reports[reportType];
                        if (reportData && Object.keys(reportData).length > 0) {
                            if (reportData.summary === "Not Available") {
                                div.innerHTML = `<p>Not Available.</p>`;
                            } else {
                                div.innerHTML = Object.entries(reportData).map(([section, content]) => {
                                    const formattedSection = section.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                                    return `<h4 class="font-semibold mt-3 text-gray-800">${formattedSection}:</h4><p class="text-sm text-gray-600">${content}</p>`
                                }).join('');
                            }
                        } else {
                             div.innerHTML = `<p>Not Available.</p>`;
                        }
                    }
                });
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy || "<p>No specific policies are cross-referenced for this report.</p>";
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
