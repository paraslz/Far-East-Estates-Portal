<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang DSK - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang DSK Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "dsk",
                "name": "Ladang DSK",
                "reportInfo": "Data based on Planting Advisory Report 1/2026 (Visit Date: 22 Jan 2026) & Agronomy Report (October 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,320.30 ha",
                            "Mature: 1,320.30 ha",
                            "Terrain: 48% Hilly, 37% Low-lying"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (2025 Actual vs Budget)",
                        "value": "24.45 / 22.34 MT",
                        "note": "9% above budget (Source: PAR)"
                    },
                    "cost": {
                        "title": "Cost of Production (2025)",
                        "value": "RM 261.65 / RM 273.56",
                        "note": "4% lower than budget (Source: PAR)"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Adequate",
                        "note": "1:12 ha ratio (Source: PAR)"
                    },
                     "pests": {
                        "title": "Pest Status",
                        "value": "Under Control",
                        "note": "Rats & Elephants Managed (Source: PAR)"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 13a5.975 5.975 0 01-3 5.197z' /></svg>", "label": "Labour Ratio", "value": "1:12 ha (Surplus)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Controlled" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (2025)", "value": "19.40%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "~2.9 MT/md (Timac)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "12-15 days" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10' /></svg>", "label": "Manuring", "value": "100% Completed" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["2021", "2022", "2023", "2024", "2025"],
                        "ffb": [15.83, 18.74, 15.24, 22.76, 24.45],
                        "rainfall": [1916.0, 2266.5, 2802.5, 2548.0, 2945.7],
                         "note": "Source: PAR 1/2026, Appendices 6 & 7"
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature Palms (8-19 years)"],
                        "data": [100],
                        "title": "Ladang DSK - Palm Age Distribution",
                        "note": "Source: Agronomy Report 2/2025, Pg. 8"
                    }
                },
                "observations": [
                    "<b>Yield Performance:</b> FFB production for 2025 was 32,275 MT (24.45 MT/Ha), exceeding the budget by 9%. Crop recovery is good with no loose fruits left behind. <span class='observation-ref'>(PAR Pg. 30, 37)</span>",
                    "<b>Pest Status (Improved):</b> While rat damage was high in Sep 2025 (22%), a recent baiting round has brought the population under control. Elephant intrusions are being managed via boundary trenches and patrols. <span class='observation-ref'>(PAR Pg. 20, 38; AR Pg. 36)</span>",
                    "<b>Manuring Status:</b> The 2025 manuring program was successfully completed in November. However, costs were 9% over budget due to fertilizer price/quantity variations. <span class='observation-ref'>(PAR Pg. 19, 42)</span>",
                    "<b>Infrastructure Damage:</b> A 5-foot culvert in field P13C5 was washed away during recent floods. A replacement with a concrete bridge is proposed to accommodate water flow. <span class='observation-ref'>(PAR Pg. 6, 22-23)</span>",
                    "<b>Hilly Terrain Access:</b> Mechanization (Timac/Crawlers) is in use, but productivity can be improved by widening narrow planting terraces and improving access/exit points in hilly fields (P15I, P16F). <span class='observation-ref'>(PAR Pg. 32)</span>",
                    "<b>Vegetation & Weeding:</b> Weeding is generally satisfactory, but barren ground was observed. The estate should focus on establishing soft grasses and beneficial cover to prevent erosion and retain moisture. <span class='observation-ref'>(PAR Pg. 17-18)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate's performance was satisfactory with FFB production of 32,275.12 MT (24.45 MT/ha), which is 9% above the annual budget. The production cost of RM 261.65/MT was 4% lower than the budget. Management is urged to focus on improving access in hilly/terraced areas, preventing elephant intrusions, and maintaining stricter security for external FFB transport. <span class='observation-ref'>(PA Report, Pg. 37-38)</span>",
                        "Area Statement": "As of Dec 2025, total planted area is 1,320.30 ha. This comprises:<br>• <b>Mature:</b> 1,320.30 ha (100%).<br>• <b>Terrain:</b> 48% Hilly, 37% Low-lying, 15% Flat/Undulating.<br>• <b>Challenges:</b> Surface runoff in hilly areas and drainage issues in low-lying areas. <span class='observation-ref'>(PA Report, Pg. 10)</span>",
                        "Labour Statement": "Current workforce is 107 workers vs requirement of 98 (Ratio 1:12 ha).<br>• <b>Harvesters:</b> 69 workers (Ratio 1:19 ha).<br>• <b>Recruitment:</b> 23 new workers recruited in 2025.<br>• <b>Status:</b> Adequate, but distribution should follow job demand. <span class='observation-ref'>(PA Report, Pg. 13)</span>",
                        "Staff Establishment": "The staff establishment is satisfactory.<br>• <b>Key Movements:</b> En. Mohd Afiq Bin Mansor (Officer In-Charge) transferred 1 Mar 2025; En. Muhammad Azamuddin (Asst. Manager) transferred 16 Nov 2025; Cik Iman Nurhaifa (Account Clerk) transferred 1 Sep 2025. <span class='observation-ref'>(PA Report, Pg. 12)</span>",
                        "General Charges": "Total General Charges are <b>RM 1,712.60/ha</b>, which is 3% below the budget of RM 1,768.08/ha.<br>• <b>Overspending:</b> 'Medical' (+272% due to higher costs), 'Water-Labour' (+121% due to leakages), 'EPF' (+83% due to min wage hike), 'Group Personal Insurance' (+100%).<br>• <b>Savings:</b> Offset by savings in other administrative headers. <span class='observation-ref'>(PA Report, Pg. 14-16)</span>",
                        "Upkeep and Cultivation": "Total cost is RM 2,255.58/ha (4.5% above budget).<br>• <b>Weeding:</b> Cost is RM 233.19/ha (Satisfactory, consistent with budget). Focus required on soft grasses.<br>• <b>Manuring:</b> Cost is RM 1,556.54/ha (9% above budget). 2025 program fully completed in Nov.<br>• <b>Pest & Disease:</b> Cost is RM 70.95/ha (6% above budget). Measures include rat baiting and elephant trenching. <span class='observation-ref'>(PA Report, Pg. 17-20)</span>",
                        "Harvesting and Collection": "YTD Cost is <b>RM 99.32/MT</b>, slightly higher than budget (RM 97.81/MT) due to higher external transport costs to Merchong Oil Mill.<br>• <b>Interval:</b> Maintained at 12-15 days.<br>• <b>Quality:</b> Satisfactory with >95% ripe crop. <span class='observation-ref'>(PA Report, Pg. 28, 33)</span>",
                        "Crop Production": "YTD (12 Months) FFB Production is <b>32,275.12 MT</b>, which is 9% above the budget of 29,500 MT.<br>• <b>Yield/Ha:</b> 24.45 MT/ha.<br>• <b>Stand per Ha:</b> 133 palms.<br>• <b>Avg Bunch Weight:</b> 15.66 kg. <span class='observation-ref'>(PA Report, Pg. 30-31)</span>",
                        "Production Cost": "YTD Ex-Estate Cost of Production is <b>RM 261.65/MT</b>, which is 4% favorable compared to the budget of RM 273.56/MT.<br>• <b>General Charges:</b> RM 70.06/MT (-11%).<br>• <b>Upkeep:</b> RM 92.27/MT (-6%).<br>• <b>Harvesting:</b> RM 99.32/MT (+1.5%). <span class='observation-ref'>(PA Report, Pg. 33)</span>",
                        "Vehicles Running Cost": "Vehicle costs are generally satisfactory.<br>• <b>Hilux (CEF 9629):</b> RM 0.63/km (8% above budget).<br>• <b>Tractor (LDSK01):</b> RM 21.06/hr (4% above budget).<br>• <b>Van Higer:</b> RM 1.30/km (In line with budget). <span class='observation-ref'>(PA Report, Pg. 36)</span>",
                        "Capital Expenditure": "• <b>Labour Quarters:</b> Pending JTK approval.<br>• <b>Solar Street Lighting:</b> Cancelled.<br>• <b>Guard Post:</b> In progress.<br>• <b>Office Partition:</b> Completed. <span class='observation-ref'>(PA Report, Pg. 34)</span>",
                        "Immature": "Not Applicable (100% Mature Estate). <span class='observation-ref'>(PA Report, Pg. 10)</span>"
                    },
                    "agronomy": {
                        "Executive Summary": "Rat damage is now a major concern, increasing to 22% in September 2025 and requiring immediate baiting. Ground vegetation has improved but remains below the desired level, with patches of undesirable weeds. Palm census and thinning of runt palms are yet to be carried out. The 2025 manuring program is delayed. <span class='observation-ref'>(AR Pg. 4-5, 11, 36)</span>",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 program was completed, but with delays up to 5 months for RP. The 2025 program is 80% complete as of Sep 2025, with a 28% delay in Mixture B due to supplier issues. EFB application is limited to 3 ha due to high transport costs. Inconsistent fertilizer placement on terraces and in mounded areas risks nutrient loss. <span class='observation-ref'>(AR Pg. 11-17)</span>",
                        "Agronomic Observation": "Harvesting interval is 10-20 days with satisfactory standards and minimal crop loss. Pruning is 100% complete and satisfactory. Palm nutrient status is generally balanced. Ground vegetation has improved but is unsatisfactory, with patches of noxious weeds (Clidemia, ferns, VOPs) requiring targeted control. Rat damage spiked to 22% in Sep 2025. Elephant intrusion was noted in P1512. <span class='observation-ref'>(AR Pg. 19-38)</span>",
                        "Yield Performance": "2024 yield was 22.76 MT/ha, a 49.4% increase from 2023. YTD Sep 2025 yield is 17.24 MT/ha, a 2.55% increase from the same period in 2024, attributed to higher bunch weight. Lower yields in blocks P14E, P16F, and P151 are linked to flooding and elephant intrusion. <span class='observation-ref'>(AR Pg. 39-41)</span>",
                        "Fertilizer Recommendation (2026)": "The 2026 program is outlined. The estate must minimize the gap between scheduled and actual application. <span class='observation-ref'>(AR Pg. 44)</span>"
                    },
                     "pinfosys": {
                        "summary": "Not Available."
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-01:</b> Initiate baiting activities promptly to control the rat population when fresh damage exceeds the threshold. <span class='observation-ref'>(AR Pg. 36)</span></p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-02b:</b> If post-baiting census shows damage still exceeds 10%, review bait palatability and re-implement the baiting campaign following a systematic, single-direction approach. <span class='observation-ref'>(PAR Pg. 43)</span></p></div> <div class='policy-item'><p class='font-semibold'>Ground Vegetation & Weeding</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-05:</b> Targeted eradication must be conducted for noxious weeds, VOPs, and ferns to prevent further spread. <span class='observation-ref'>(AR Pg. 30-32; PAR Pg. 20)</span></p></div> <div class='policy-item'><p class='font-semibold'>Infrastructure Maintenance</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-ROAD-03:</b> On hilly terrain, construct and maintain adequate roadside sumps and run-off drains to prevent erosion of the road surface. <span class='observation-ref'>(PAR Pg. 26-27)</span></p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Labour') ? 'bg-purple-50 text-purple-800' : 'bg-red-50 text-red-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-1 text-gray-900">${estate.name}</h2>
                        <p class="text-md text-gray-600 mb-2">Based on Planting Advisory Visit (Jan 2026) & Agronomy Visit (Oct 2025)</p>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">5-Year Production vs Rainfall Trend</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Jan 2026)</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details (Oct 2025)</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Yield (MT/Ha)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Yield (MT/Ha)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#16a34a', '#facc15', '#ef4444'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'bottom' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                Object.keys(estateData.reports).forEach(reportType => {
                    const div = document.getElementById(`${estateData.id}-${reportType}`);
                    if (div) {
                        const reportData = estateData.reports[reportType];
                        if (reportData && Object.keys(reportData).length > 0) {
                            if (reportData.summary === "Not Available") {
                                div.innerHTML = `<p>Not Available.</p>`;
                            } else {
                                div.innerHTML = Object.entries(reportData).map(([section, content]) => {
                                    const formattedSection = section.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                                    return `<h4 class="font-semibold mt-3 text-gray-800">${formattedSection}:</h4><p class="text-sm text-gray-600">${content}</p>`
                                }).join('');
                            }
                        } else {
                             div.innerHTML = `<p>Not Available.</p>`;
                        }
                    }
                });
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy || "<p>No specific policies are cross-referenced for this report.</p>";
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
