<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Sungai Marung - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="../index.html" class="flex items-center">
                    Ladang Sungai Marung Report
                </a>
            </div>
            <a href="../estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "sgmarung",
                "name": "Ladang Sungai Marung",
                "reportInfo": "Data based on PA Report (Sep 2025) & Agronomy Report (Apr 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 2,250.23 ha",
                            "Mature: 1,423.50 ha",
                            "Immature: 455.73 ha",
                            "Replanting: 371.00 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (2024 vs 2023)",
                        "value": "19.50 / 15.03 MT",
                        "note": "A 29.74% increase from 2023 (AR data)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "RM 240.56 / RM 397.75",
                        "note": "YTD August '25, 40% lower than budget"
                    },
                     "upkeep": {
                        "title": "Upkeep Status",
                        "value": "Satisfactory",
                        "note": "Pruning & weeding standards satisfactory"
                    },
                    "pest": {
                        "title": "Key Pest Status",
                        "value": "Under Control",
                        "note": "Ganoderma census underway"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:20 ha (Shortage of 37)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Ratio", "value": "1:26 ha (Shortage of 28)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Rat damage minimal (<10%)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD Aug '25)", "value": "18.76%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "~3.0 MT/day" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "Avg. 15 days (15.86 rounds)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Manuring Status", "value": "Up to date" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["2020", "2021", "2022", "2023", "2024"],
                        "ffb": [21.38, 19.17, 14.20, 15.03, 19.50],
                        "rainfall": [2168, 2550, 2416, 4643, 4756],
                        "note": "*Annual FFB Yield (MT/Ha) and Rainfall (mm) (Source: AR)."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Yrs (Immature)", "4-7 Yrs (Young)", ">26 Yrs (Old)"],
                        "data": [28, 11, 60],
                        "title": "Ladang Sungai Marung - Palm Age Profile (2025)",
                        "note": "*No palms in prime (8-19 yrs) or declining (20-25 yrs) age categories (Source: AR)."
                    }
                },
                "observations": [
                    "<b>Chronic Flooding in Low-Lying Areas:</b> This is a major issue, with ~800ha affected by water from surrounding areas. It severely impacts immature blocks (P21A, P22C, P22D) causing palm losses and disrupting work. <span class='observation-ref'>(PAR Pg. 23, 45; AR Pg. 59, 64)</span>",
                    "<b>Labour & Harvester Shortage:</b> The estate is short 37 workers (1:20 ha ratio). The harvester ratio is high at 1:26 ha, though harvester productivity is currently satisfactory (~3 MT/day). 25 new workers are expected. <span class='observation-ref'>(PAR Pg. 13-14, 32)</span>",
                    "<b>Ganoderma & Age Profile:</b> A Ganoderma census is underway in old mature fields (P94K, P96Y). This is critical as the agronomy report noted 60% of palms are in the old age category (>26 years). <span class='observation-ref'>(PAR Pg. 21; AR Pg. 9, 12)</span>",
                    "<b>Immature Area Challenges:</b> Besides flooding, sporadic Rhinoceros beetle attacks persist in P22D and P24F. Replanting block P22E (~85 ha) has been abandoned and categorized as unplantable. <span class='observation-ref'>(PAR Pg. 35, 37, 39)</span>",
                    "<b>Improved Upkeep Standards:</b> The recent PA visit noted satisfactory weeding and pruning standards. This is an improvement on the Agronomy report, which noted unsatisfactory weeding. <span class='observation-ref'>(PAR Pg. 19, 27; AR Pg. 5, 47-49)</span>",
                    "<b>Harvesting & Manuring Status:</b> Harvesting standards are now satisfactory (per PAR), an improvement from earlier reports of poor crop recovery (per AR). The manuring program is also now up-to-date. <span class='observation-ref'>(PAR Pg. 20, 28; AR Pg. 4, 6, 27-31)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance is satisfactory. FFB production for 8 months (YTD Aug '25) is 16% above budget, and ex-estate cost is 40% below. Key challenges are the labour shortage (1:20 ha ratio), Ganoderma in mature fields, and severe flooding in low-lying areas (~800 ha) impacting immature fields. (Source: PAR, Pg. 43-45)",
                        "Area Statement": "Total planted area is 2,250.23 ha, comprising 1,423.50 ha mature, 455.73 ha immature, and 371.00 ha replanting. Field P96Y (267.70 ha) is identified for 2026 replanting. (Source: PAR, Pg. 11-12)",
                        "Labour Statement": "Total of 113 workers, a shortage of 37 (1 worker: 20 ha). Harvester ratio is 1:26 ha. 25 new Indonesian workers are expected in October. (Source: PAR, Pg. 13-14)",
                        "Staff Establishment": "The staff complement is sufficient. (Source: PAR, Pg. 15)",
                        "General Charges": "Expenditure as of Aug 2025 is 44% lower than budget (RM 647.59/ha). Overspending noted on Staff Welfare and Workmen's Comp. (Source: PAR, Pg. 16-17)",
                        "Upkeep and Cultivation": "Weeding is satisfactory and 6% below budget. Manuring is up-to-date, aided by semi-mechanised application. Pruning standards are good and 14% below budget. Road grading is in progress. Ganoderma census is underway. (Source: PAR, Pg. 18-27)",
                        "Harvesting and Collection": "Harvesting interval is good (avg. 15 days). Standards are satisfactory with good loose fruit recovery. Cost is RM 103.66/tonne (18% below budget). (Source: PAR, Pg. 28-29)",
                        "Crop Production": "YTD Aug 2025 FFB production is 13,171.37 MT (16% above budget). YTD yield is 11.11 MT/ha. (Source: PAR, Pg. 30)",
                        "Production Cost": "Ex-estate cost as of Aug 2025 is RM 240.56/ton, 40% lower than budget (RM 397.75/ton). (Source: PAR, Pg. 31)",
                        "Vehicles Running Cost": "Acceptable and under budget. (Source: PAR, Pg. 33)",
                        "Capital Expenditure": "New Assistant Manager and staff bungalows are complete but pending TNB connection and CF before furniture is purchased. (Source: PAR, Pg. 41)",
                        "Immature/Replanting": "Flooding is a major issue. P21A & P22D scout harvesting has begun. P22C supplying (30 ha) is deferred due to flood risk. P22E (85 ha) is abandoned as unplantable. P25G (206 ha) planting is complete. (Source: PAR, Pg. 34-40)"
                    },
                    "agronomy": {
                        "Executive Summary": "Agronomic conditions were examined, and yield-limiting factors have been highlighted for corrective action. Key issues include harvesting quality, manuring delays due to flooding, and challenges with immature plantings in flood-prone areas. (Source: AR, Pg. 4-7)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 manuring program was 94% complete, with some fertilizers not fully applied due to palm losses from flooding. The 2025 program is delayed as of March due to heavy rain and inaccessible blocks. The fertilizer store has wet floor conditions that need investigation. (Source: AR, Pg. 13-15)",
                        "Agronomic Observation": "Harvesting intervals are acceptable (15-18 days), but quality needs improvement with 5-10% overripe bunches observed. Loose fruit collection is incomplete. Pruning is generally satisfactory, but some areas are slightly under-pruned. Weeding is acceptable, but undesirable weeds and VOPs persist in localized areas. Rat damage is low. (Source: AR, Pg. 25-51)",
                        "Immature/Young Mature Plantings": "Significant supplying (36,170 palms) has been conducted in blocks P21A, P21B, P22D, and P24F due to flood damage. Growth is variable, with palms on higher ground showing better vigor. Over-pruning was noted. P24F includes a strategic watermelon intercropping project to reduce Ganoderma risk. (Source: AR, Pg. 56-70)",
                        "Yield Performance": "FFB yield increased by 29.74% in 2024 (19.50 MT/Ha) compared to 2023 (15.03 MT/Ha), mainly due to an increase in bunches per palm. However, yield is inconsistent and heavily impacted by seasonal flooding in low-lying areas, affecting crop evacuation. (Source: AR, Pg. 74-78)",
                        "Fertilizer Recommendation": "No changes to the 2025 fertilizer program. The estate is urged to minimize delays between scheduled and actual application. Recommendations are provided for new plantings. (Source: AR, Pg. 84)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Replanting & Immature Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: REPLANT-FLOOD-01:</b> In flood-prone areas, supplying should be deferred until floodwaters recede. Consider raising planting platforms or constructing bunds for future plantings.</p><p class='text-sm text-gray-600'><b>Policy Ref: UPKEEP-IM-02:</b> Basal frond pruning must be completed before scout harvesting begins.</p></div> <div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-03:</b> Complete collection of all loose fruits is mandatory. Supervisors must conduct daily checks.</p></div> <div class='policy-item'><p class='font-semibold'>Labour Management</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-PROD-02:</b> Estates must monitor harvester productivity against targets. Implement training or review mechanization if consistently below target.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Upkeep') ? 'bg-green-50 text-green-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass} shadow-sm"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass} shadow-sm"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Annual Yield & Rainfall (from AR)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile (from AR)</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues (Blended)</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Sep 2025)</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details (Apr 2025)</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Yield (MT/Ha)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Yield (MT/Ha)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#60a5fa', '#ef4444'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (agronomyDiv) {
                    agronomyDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (plantationDiv) {
                    plantationDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                } else if (pinfosysDiv) {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = ` <div class='policy-item'><p class='font-semibold'>Replanting & Immature Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: REPLANT-FLOOD-01:</b> In flood-prone areas, supplying should be deferred until floodwaters recede. Consider raising planting platforms or constructing bunds for future plantings.</p><p class='text-sm text-gray-600'><b>Policy Ref: UPKEEP-IM-02:</b> Basal frond pruning must be completed before scout harvesting begins to ensure harvester access and safety.</p></div> <div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-03:</b> Complete collection of all loose fruits is mandatory. Supervisors must conduct daily checks.</p></div> <div class='policy-item'><p class='font-semibold'>Labour Management</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-PROD-02:</b> Estates must monitor harvester productivity against targets. Implement training or review mechanization if consistently below target.</p></div>`;
            modalTitle.innerText = 'Agricultural Policy Cross-Reference: Ladang Sungai Marung';
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
