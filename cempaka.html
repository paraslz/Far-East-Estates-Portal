<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Cempaka - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Cempaka Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "cempaka",
                "name": "Ladang Cempaka",
                "reportInfo": "Data based on PA Report (Oct 2024) & Agronomy Report (July 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 494.33 ha",
                            "Mature: 167.64 ha",
                            "Immature: 326.69 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "13.86 / 15.00 MT",
                        "note": "YTD as of Sep 2024 (PA Report)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "RM 291.05 / RM 340.84",
                        "note": "Ex-Estate, YTD as of Sep 2024 (PA Report)"
                    },
                    "upkeep": {
                        "title": "Upkeep Status",
                        "value": "Mediocre",
                        "note": "Weeding & pruning issues"
                    },
                     "labour": {
                        "title": "Labour Status",
                        "value": "Shortage",
                        "note": "Deficit of 5 immature harvesters"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:18 ha (Short 5 Harvesters)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Under Control (Rats at 4%)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "19.18% (PA Report)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "1.56 MT/md (PA Report)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~14-17 days (Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Manuring 41-52% Done" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan-25", "Feb-25", "Mar-25", "Apr-25", "May-25", "Jun-25"],
                        "ffb": [307.34, 209.34, 295.70, 314.46, 267.46, 366.24],
                        "rainfall": [151.0, 43.0, 138.0, 339.0, 206.0, 171.0],
                        "note": "*FFB production and rainfall data for 2025 (YTD June)."
                    },
                    "ageProfile": {
                        "labels": ["Mature (P18 - 2018)", "Immature (P22 - 2022)", "Immature (P23 - 2023)"],
                        "data": [34, 30, 36],
                        "title": "Ladang Cempaka - Palm Age Distribution (by Planted Year)",
                        "note": "*Source: Agronomy Report 2/2025, Pg. 8."
                    }
                },
                "observations": [
                    "<b>Overall Performance is Mediocre:</b> The estate needs to resolve repetitive issues, particularly the quality of weeding and pruning standards, which are behind schedule. <span class='observation-ref'>(PAR Pg. 18-28, 48-50)</span>",
                    "<b>Critical Labour Shortage:</b> The estate has a deficit of 7 workers, including a shortage of 5 upkeep workers and 5 immature harvesters. This impacts multiple field operations and contributes to low harvester productivity (1.56 tons/man-day). <span class='observation-ref'>(PAR Pg. 11; AR Pg. 25)</span>",
                    "<b>Poor Immature Area Management:</b> Weeding is poor, palm supplying is incomplete, and EFB mulching is progressing very slowly, especially in P22B and P23A. <span class='observation-ref'>(PAR Pg. 36-45; AR Pg. 5)</span>",
                    "<b>Widespread Over-Pruning:</b> A high incidence of over-pruned palms was found in both mature (PA report) and immature areas (AR report), which is unacceptable and must be resolved immediately. <span class='observation-ref'>(PAR Pg. 22; AR Pg. 27-28)</span>",
                    "<b>Rat Infestation Requires Monitoring:</b> While rat infestation has been reduced to ~4% after baiting, fresh damage is still detected. Close monitoring is required to keep the pest under control. <span class='observation-ref'>(AR Pg. 22, 33-34)</span>",
                    "<b>Delayed Manuring Program:</b> The first-half manuring program was delayed due to late fertilizer delivery, although the issue has since been resolved. <span class='observation-ref'>(AR Pg. 11)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate's performance is mediocre due to repetitive issues like poor weeding in immature areas, over-pruning, and low harvester productivity. FFB production is below budget. Urgent attention is needed for upkeep in immature areas, especially palm supplying and EFB mulching. (Source: PAR, Pg. 48-50)",
                        "Area Statement": "Total planted area is 451.00 ha, consisting of 167.64 ha mature (37%) and 283.36 ha immature (63%). Includes 43.33 ha of ex-tapping right area. (Source: PAR, Pg. 9)",
                        "Labour Statement": "Total of 27 workers, a deficit of 7 from the requirement of 34. There is a surplus of 3 harvesters but a shortage of 5 upkeep workers. Harvester productivity is low at 1.56 tons/man-day. (Source: PAR, Pg. 11)",
                        "Staff Establishment": "Staff complement is satisfactory with no changes since the last visit. (Source: PAR, Pg. 13)",
                        "General Charges": "Expenditure is 7% lower than budget as of September. Overspending noted on items like travel allowance, staff bonuses, and security. (Source: PAR, Pg. 14-17)",
                        "Upkeep and Cultivation": "Weeding programs are behind schedule. Road grading was completed, but surfacing with crusher run has not been done. Over-pruning is a major issue. (Source: PAR, Pg. 18-28)",
                        "Harvesting and Collection": "Cost per tonne (RM 102.16) is 15% lower than budget. Harvesting standard needs improvement due to over-pruning and harvesting of unripe/long-stalked bunches. (Source: PAR, Pg. 29-30)",
                        "Crop Production": "YTD September FFB production is 2,323.09 MT, which is 8% lower than budget. Yield per ha is 13.86 MT. (Source: PAR, Pg. 31-32)",
                        "Production Cost": "Ex-estate cost per tonne (RM 291.05) is 15% lower than budget. (Source: PAR, Pg. 34)",
                        "Vehicles Running Cost": "Generator set running costs were 17% higher than budget due to engine repairs. (Source: PAR, Pg. 47)",
                        "Capital Expenditure": "RM 4,915.00 spent on a new computer and printer. (Source: PAR, Pg. 46)",
                        "Immature": "P22B: Palm supply is incomplete, EFB mulching not done, and palm circles are weedy. P23A: EFB mulching is very slow (only 19 ha completed), weeding is behind schedule, and Oryctes damage detected. (Source: PAR, Pg. 36-45)"
                    },
                    "agronomy": {
                        "Executive Summary": "Focus is required on weeding standards, VOP eradication, and resolving labour shortages for immature harvesting. Rat infestation has been reduced but requires monitoring. Manuring progress has improved after initial delays. (Source: AR, Pg. 5, 45)",
                        "Nutrient Inputs/Progress of Manuring": "First-half manuring is 41% complete for mature areas and 52% for immature. Delivery issues for Mixture B have been resolved, and the next consignment is expected in August. (Source: AR, Pg. 11-12)",
                        "Agronomic Observation": "P18C (Mature): Yield has increased by 35.9%. Weeding and pruning are slightly delayed. Rat attacks reduced from 15% to 4%. P22 (Immature): Yield is low in P22D due to accessibility issues and labour shortage. Over-pruning was observed. VOPs need eradication. P23 (Immature): Palm vigour is improving. Rat and Oryctes are under control, but Apogonia requires treatment. (Source: AR, Pg. 13-41)",
                        "Yield Performance": "P18C yield increased by 35.9% compared to last year. P22B immature yield is 8.7% above estimate, but P22D is 54.4% below due to labour and access issues. Harvesting rounds for immature fields are behind schedule. (Source: AR, Pg. 43-44)",
                        "Fertilizer Recommendation": "The 2026 fertilizer program has been formulated, recommending Mixture B, RP, and Kieserite for mature palms, and compound fertilizers for immature areas. (Source: AR, Pg. 46-47)"
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Immature Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: UPKEEP-IM-01:</b> EFB mulching must be completed within 3 months of planting. Palm supplying must be completed within 6 months.</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-IM-03:</b> Weeding rounds in immature areas must be strictly followed as per schedule to prevent competition and establish ground cover.</p></div> <div class='policy-item'><p class='font-semibold'>Pruning Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-01:</b> Over-pruning is strictly prohibited. Field supervisors must conduct pre- and post-pruning checks to ensure compliance.</p></div> <div class='policy-item'><p class='font-semibold'>Labour Management</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-MANPOWER-01:</b> Estate managers must maintain the budgeted worker-to-land ratio. Any shortage exceeding 10% must be reported with a recruitment plan.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Upkeep') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'line',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4, borderDash: [5, 5] },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, type: 'bar', backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#ca8a04', '#fde047', '#facc15'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = ` <div class='policy-item'><p class='font-semibold'>Immature Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: UPKEEP-IM-01:</b> EFB mulching must be completed within 3 months of planting. Palm supplying must be completed within 6 months.</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-IM-03:</b> Weeding rounds in immature areas must be strictly followed as per schedule to prevent competition and establish ground cover.</p></div> <div class='policy-item'><p class='font-semibold'>Pruning Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-01:</b> Over-pruning is strictly prohibited. Field supervisors must conduct pre- and post-pruning checks to ensure compliance.</p></div> <div class='policy-item'><p class='font-semibold'>Labour Management</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-MANPOWER-01:</b> Estate managers must maintain the budgeted worker-to-land ratio. Any shortage exceeding 10% must be reported with a recruitment plan.</p></div>`;
            modalTitle.innerText = 'Agricultural Policy Cross-Reference: Ladang Cempaka';
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
