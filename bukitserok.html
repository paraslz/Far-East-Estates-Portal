<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Bukit Serok - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Bukit Serok Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "bukitserok",
                "name": "Ladang Bukit Serok",
                "reportInfo": "Data based on PA Report (May 2025) & Agronomy Report (Feb 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 2,226.40 ha",
                            "Mature: 2,058.80 ha",
                            "FEHB Division: 167.60 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "5.61 / 5.25 MT",
                        "note": "YTD as of Apr 2025"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "RM 201.79 / RM 364.62",
                        "note": "Ex-Estate, YTD as of Apr 2025"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Inadequate",
                        "note": "Shortage of 5 harvesters & 5 sprayers"
                    },
                     "pests": {
                        "title": "Pest Status",
                        "value": "Action Required",
                        "note": "Significant rat & bagworm damage"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:15 ha (Overall Adequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "High (Rats & Bagworms)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "18.90%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "1.83 MT/md (Unacceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~15 days (Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Marginal N & K Low" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan-24", "Feb-24", "Mar-24", "Apr-24", "May-24", "Jun-24", "Jul-24", "Aug-24", "Sep-24", "Oct-24", "Nov-24", "Dec-24"],
                        "ffb": [3737, 3644, 4648, 5239, 6221, 5972, 6276, 6025, 5911, 5004, 4201, 3546],
                        "rainfall": [557, 21, 63, 117, 66, 168, 109, 64, 213, 151, 346, 229],
                        "note": "*FFB production and rainfall data for 2024."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Years", "4-7 Years", "8-19 Years (Prime)", "20-25 Years (Old)", ">26 Years"],
                        "data": [0, 0, 63, 37, 0],
                        "title": "Ladang Bukit Serok - Palm Age Distribution",
                        "note": "*Source: Agronomy Report 1/2025, Pg. 10."
                    }
                },
                "observations": [
                    "<b>Labour Shortage & Productivity:</b> The estate is short of 5 harvesters and 5 sprayers. Harvester productivity is unacceptably low at 1.83 tons/man-day. <span class='observation-ref'>(PAR Pg. 4, 11-12)</span>",
                    "<b>Pest Infestations:</b> Significant rat damage was detected in several fields, requiring a census and baiting. Bagworm infestation is also significant and treatments have been conducted. <span class='observation-ref'>(AR Pg. 5, 37, 41)</span>",
                    "<b>Delayed Field Work:</b> The 2025 manuring program has not yet started. Road grading has not commenced for the year, and circle/selective weeding is behind schedule. <span class='observation-ref'>(AR Pg. 12; PAR Pg. 4, 21)</span>",
                    "<b>Pruning Standards:</b> While progressive pruning is ongoing, sections in P01A and P02B are under-pruned, which reduces harvesting efficiency. <span class='observation-ref'>(AR Pg. 5, 21; PAR Pg. 5, 26)</span>",
                    "<b>Palm Health:</b> Overall palm vigour is acceptable, but palms in sandy/laterite soils show poor vigour. Foliar analysis shows marginal N and K deficiency. <span class='observation-ref'>(AR Pg. 5, 27)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance is acceptable with FFB production above budget and costs below budget. However, there is an inadequate number of harvesters and low productivity. Key upkeep works like weeding and road grading are behind schedule. Pruning quality in tall palm areas needs improvement. (Source: PAR, Pg. 46-48)",
                        "Area Statement": "Total planted area is 2,226.40 ha, with 37.2% old mature palms and 62.8% prime mature palms. No replanting is planned for 2025. (Source: PAR, Pg. 10)",
                        "Labour Statement": "Total of 154 workers, resulting in a shortage of 12. Specifically, there is a shortage of 5 harvesters and 5 sprayers. Harvester productivity at 1.83 tons/man-day is below the target of 2.50 tons. (Source: PAR, Pg. 11-12)",
                        "Staff Establishment": "Staff complement is satisfactory. New probation clerks were appointed in March 2025. (Source: PAR, Pg. 13-14)",
                        "General Charges": "Expenditure as of April is 51% lower than budget, which is well-controlled. (Source: PAR, Pg. 15)",
                        "Upkeep and Cultivation": "Weeding programs are behind schedule. Road grading has not yet started. Pruning in tall palms (P01A, P02B) needs improvement. Manuring programs are delayed. (Source: PAR, Pg. 17-34)",
                        "Harvesting and Collection": "Cost per tonne (RM 75.59) is 31% lower than budget. Harvesting intervals are acceptable at ~15 days, but harvesting standards need improvement. (Source: PAR, Pg. 35-38)",
                        "Crop Production": "YTD April FFB production is 11,541.28 MT, 7% higher than budget but 28% lower than the same period last year. (Source: PAR, Pg. 39)",
                        "Production Cost": "Ex-estate cost per tonne (RM 201.79) is 45% lower than budget. (Source: PAR, Pg. 43)",
                        "Vehicles Running Cost": "Running cost for Toyota Hilux was 46% higher than budget due to new tyres and insurance. Tractor cost was 1% lower than budget. (Source: PAR, Pg. 45)",
                        "Capital Expenditure": "No capital expenditure incurred during the review period. (Source: PAR, Pg. 44)",
                        "Immature": "N/A"
                    },
                    "agronomy": {
                        "Executive Summary": "The estate performed well in 2024, with most fields yielding >25 mt/ha. Key issues for 2025 are significant rat and bagworm infestations, and a delay in starting the manuring program. Palm vigour is generally acceptable, though some nutrient deficiencies are noted. (Source: AR, Pg. 4-6, 47)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 manuring program was completed without delay. The 2025 program has not started as fertilizers have not been received. 18,553 MT of EFB was applied in 2024, mainly in Block B2. (Source: AR, Pg. 12-17)",
                        "Agronomic Observation": "Harvesting intervals and crop recovery are acceptable. Canopy management is effective, but some under-pruned areas persist. Rat and bagworm infestations are significant and require control measures. Ganoderma infection is not severe. (Source: AR, Pg. 19-44)",
                        "Yield Performance": "Yield in 2024 was 27.14 mt/ha, a 150% increase from 2023. Key yield-limiting factors to address are the slow start to 2025 manuring, incomplete pruning, and pest infestations. (Source: AR, Pg. 45-47)",
                        "Fertilizer Recommendation": "The 2025 fertilizer program has been amended for P02B2. The estate must ensure timely completion once fertilizers are received. (Source: AR, Pg. 48)"
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Control (Rats & Bagworms)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-01:</b> Conduct quarterly census. If damage >10%, initiate baiting campaign with 2nd-gen rodenticides.</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-LeafEater-03:</b> For bagworm infestation >10 larvae/frond, conduct trunk injection or targeted spraying with approved insecticides.</p></div> <div class='policy-item'><p class='font-semibold'>Labour Productivity</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-PROD-02:</b> Estates must monitor harvester productivity against a target of >2.5 tons/man-day. Implement training or review mechanization if consistently below target.</p></div> <div class='policy-item'><p class='font-semibold'>Field Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-ROAD-01:</b> Road grading must be completed annually before the main monsoon season (by July 31st).</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-PRUNE-02:</b> Progressive pruning must be consistently implemented. Under-pruned conditions in tall palm areas must be rectified within one harvesting cycle.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Labour') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2024)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#facc15', '#eab308', '#ca8a04', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = ` <div class='policy-item'><p class='font-semibold'>Pest Control (Rats & Bagworms)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-01:</b> Conduct quarterly census. If damage >10%, initiate baiting campaign with 2nd-gen rodenticides.</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-LeafEater-03:</b> For bagworm infestation >10 larvae/frond, conduct trunk injection or targeted spraying with approved insecticides.</p></div> <div class='policy-item'><p class='font-semibold'>Labour Productivity</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-PROD-02:</b> Estates must monitor harvester productivity against a target of >2.5 tons/man-day. Implement training or review mechanization if consistently below target.</p></div> <div class='policy-item'><p class='font-semibold'>Field Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-ROAD-01:</b> Road grading must be completed annually before the main monsoon season (by July 31st).</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-PRUNE-02:</b> Progressive pruning must be consistently implemented. Under-pruned conditions in tall palm areas must be rectified within one harvesting cycle.</p></div>`;
            modalTitle.innerText = 'Agricultural Policy Cross-Reference: Ladang Bukit Serok';
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
