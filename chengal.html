<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Chengal - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Chengal Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "chengal",
                "name": "Ladang Chengal",
                "reportInfo": "Data based on Agronomy Report (Mar 2025) & Plantation Advisory Report (Visit: 23 June 2025, Reviewed: Jan-May 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,814.20 ha",
                            "Mature: 1,814.20 ha",
                            "Vacant/Unplantable: 374.80 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD May 2025)",
                        "value": "7.37 MT",
                        "note": "-12% vs Budget"
                    },
                    "cost": {
                        "title": "Production Cost/Tonne",
                        "value": "RM 260.86",
                        "note": "-10% vs Budget (Favourable)"
                    },
                    "manuring": {
                        "title": "Manuring Progress",
                        "value": "Delayed",
                        "note": "Applications for Mar-May not completed."
                    },
                     "pruning": {
                        "title": "Pruning Progress",
                        "value": "80% Complete",
                        "note": "Unsatisfactory quality persists."
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:13 ha (Adequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Conflicting (Rats)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "19.03%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "1.61 MT/day (Low)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "18-21 days (Extended)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Manuring Delayed" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May"],
                        "rainfall": [159.5, 90.0, 143.0, 470.5, 125.5],
                        "note": "Rainfall data from Jan-May 2025. Cumulative FFB production was 13,372.35 MT (-12% vs budget). (PAR Pg. 37, 54)"
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature (8-19 yrs)", "Old Mature (>19 yrs)"],
                        "data": [65.18, 34.82],
                        "title": "Ladang Chengal - Palm Age Distribution",
                        "note": "*Source: Plantation Advisory Report 1/2025, Pg. 9."
                    }
                },
                "observations": [
                    "<b>Yield Performance Below Target:</b> FFB production as of May is 12% lower than budget, confirming a significant yield decline noted earlier in the year. This is linked to extended harvesting intervals and upkeep issues. <span class='observation-ref'>(AR Pg. 47, PAR Pg. 37)</span>",
                    "<b>Critical & Persistent Upkeep Delays:</b> Both reports highlight that manuring and pruning are behind schedule. The PA report adds that circle weeding quality is poor and also delayed, creating messy field conditions that hinder work. <span class='observation-ref'>(AR Pg. 14, 25; PAR Pg. 17, 30, 44)</span>",
                    "<b>Poor Harvesting Standards & Productivity:</b> Harvesting intervals are extended to 18-21 days and harvester productivity is low (1.61 MT/day). Both reports cite poor loose fruit collection, indicating a persistent operational weakness. <span class='observation-ref'>(AR Pg. 22; PAR Pg. 12, 33)</span>",
                    "<b>Conflicting Pest Status (Rats):</b> The Agronomy report (Mar) showed an 'alarming' rat infestation (>10%), requiring immediate action. The PA report (Jun) states fresh damage is 'negligible,' indicating baiting may have been effective but requires continued vigilance. <span class='observation-ref'>(AR Pg. 6, 42; PAR Pg. 28)</span>",
                    "<b>Slow Road Maintenance:</b> Road grading is significantly behind schedule, with only 13% of the budgeted area completed, which affects field accessibility and transport efficiency. <span class='observation-ref'>(PAR Pg. 21, 44)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance is acceptable with lower production costs, but FFB production is below budget. Key issues include low harvester productivity, delayed weeding and manuring, and the need to improve upkeep quality. (PAR Pg. 44-46)",
                        "Area Statement": "Total planted area is 1,814.20 ha, comprising 65.18% prime mature palms and 34.82% old mature palms. Unplantable and vacant areas total 374.80 ha. (PAR Pg. 9)",
                        "Labour Statement": "The workforce is adequate with a ratio of 1 worker to 13 ha. However, there is a shortage of 6 workers for manuring. Harvester productivity is low at 1.61 tons/man-day. (PAR Pg. 11-12)",
                        "Staff Establishment": "Staff complement is satisfactory with a supervisor ratio of 1:363 ha. Several transfers, a resignation, a retirement, and a new appointment occurred in the period. (PAR Pg. 13-14)",
                        "General Charges": "Expenditure is 23% lower than budget. Overspending occurred in Executive Travel, Manager's Bungalow Upkeep, SOCSO contributions, Labour Recruitment, Permit Renewals, and Assessment Tax, with justifications provided. (PAR Pg. 15-16)",
                        "Upkeep and Cultivation": "Expenditure is 23% below budget. Weeding, manuring, and pruning are behind schedule. Road maintenance is slow. (PAR Pg. 17, 44)",
                        "Harvesting and Collection": "Harvesting intervals are too long (up to 21 days). Harvesting standards need improvement regarding loose fruit collection and avoiding over-pruning. FFB quality is affected by unripe bunches and debris. (PAR Pg. 33-36)",
                        "Crop Production": "YTD May FFB production is 13,372.35 MT, which is 12% below budget and 14% below last year. Estate yield is 7.37 MT/ha. (PAR Pg. 37)",
                        "Production Cost": "FFB cost of production ex-estate (RM 260.86/tonne) is 10% lower than budget, mainly due to lower upkeep and cultivation costs. (PAR Pg. 41)",
                        "Vehicles Running Cost": "Cost for Tractor John Deere was 41% higher than the budget due to low running hours and repairs. Van cost was 20% higher due to repairs. (PAR Pg. 43)",
                        "Capital Expenditure": "No capital expenditure was incurred during the review period. (PAR Pg. 42)",
                        "Mechanization": "Mechanized infield collection covers 85% of the harvesting area. Productivity using Timac (2.05 tons/day) and Mini Crawler (2.15 tons/day) needs improvement. (PAR Pg. 39-40, 45)"
                    },
                    "agronomy": {
                        "Executive Summary": "Yield performance was satisfactory in 2024 but has declined significantly in early 2025. Key issues are an alarming rat infestation, delays in manuring and pruning, and poor harvesting standards (loose fruit collection). These must be addressed to improve yield. (Source: AR, Pg. 4-7, 49-50)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 program was completed with some delays. The 2025 program is ongoing, but sub-soil application is slow and some blocks are pending. The fertilizer store needs maintenance to prevent wetness. (Source: AR, Pg. 13-16)",
                        "Agronomic Observation": "Harvesting intervals are extended (>15 days). Loose fruit collection is poor. Pruning is behind schedule with under-pruned conditions. Weeding is acceptable, but circle weeding is delayed. Rat infestation is alarming and requires immediate action. Bagworms and termites also need monitoring. (Source: AR, Pg. 21-46)",
                        "Yield Performance": "Yield in 2024 was satisfactory. However, yield as of Feb 2025 is 30% lower than the same period in 2024, which is below expectation. This is attributed to extended harvesting intervals and other maintenance delays. (Source: AR, Pg. 47-48)",
                        "Fertilizer Recommendation": "No amendments to the 2025 fertilizer program are recommended at this time. (Source: AR, Pg. 51)"
                    },
                    "pinfosys": {
                        "summary": "Key Metrics (YTD May 2025): Total Income (N/A), Operating Profit (N/A), Cost of Production (RM 260.86/Tonne), Manuring Cost (RM 403.99/Ha), General Charges (RM 598.46/Ha). (PAR Pg. 15, 17, 41)",
                        "expenditure": [
                            { "category": "Upkeep & Cultivation", "item": "Weeding", "rm_ha": "115.12", "rm_tonne": "-" },
                            { "category": "Upkeep & Cultivation", "item": "Manuring", "rm_ha": "403.99", "rm_tonne": "-" },
                            { "category": "Upkeep & Cultivation", "item": "P&D", "rm_ha": "27.17", "rm_tonne": "-" },
                            { "category": "Upkeep & Cultivation", "item": "Road & Bridges", "rm_ha": "92.66", "rm_tonne": "-" },
                            { "category": "Upkeep & Cultivation", "item": "Pruning", "rm_ha": "63.98", "rm_tonne": "-" },
                            { "category": "Harvesting & Collection", "item": "Harvesting", "rm_ha": "-", "rm_tonne": "49.78" },
                            { "category": "Harvesting & Collection", "item": "Internal Transport", "rm_ha": "-", "rm_tonne": "29.83" }
                        ]
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-01:</b> The PA report notes fresh rat damage is negligible, but the earlier Agronomy Report found infestation >10%, triggering the policy for baiting. Continuous monitoring is essential. (AR Pg. 6, PAR Pg. 28)</p></div> <div class='policy-item'><p class='font-semibold'>Field Upkeep</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-03 & FERT-APP-06:</b> The PA report highlights that both pruning and manuring are behind schedule, which contravenes standard operating policies. (PAR Pg. 25, 30)</p></div> <div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-03 & HARV-INT-01:</b> The PA report indicates extended harvesting intervals (>15 days) and poor loose fruit collection, which violates policies on harvesting standards and intervals. (PAR Pg. 33-34)</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Cost') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Manuring') ? 'bg-yellow-50 text-yellow-800' : 'bg-orange-50 text-orange-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues (Combined Reports)</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys / Financial Summary (from PA Report)</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-rainfall': { type: 'linear', position: 'left', title: { display: true, text: 'Rainfall (mm)' } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#16a34a', '#f59e0b'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (pinfosysDiv && estateData.reports.pinfosys) {
                    const expenditureTable = `
                        <div class="overflow-x-auto mt-4">
                            <table class="min-w-full bg-white text-sm">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">Item</th>
                                        <th class="py-2 px-4 text-right">Cost (RM/Ha)</th>
                                        <th class="py-2 px-4 text-right">Cost (RM/Tonne)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${estateData.reports.pinfosys.expenditure.map(item => `
                                    <tr class="border-b">
                                        <td class="py-2 px-4 font-medium">${item.item} <span class="text-xs text-gray-500">(${item.category.split(' ')[0]})</span></td>
                                        <td class="py-2 px-4 text-right">${item.rm_ha}</td>
                                        <td class="py-2 px-4 text-right">${item.rm_tonne}</td>
                                    </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    pinfosysDiv.innerHTML = `<h4 class="font-semibold mt-2 text-gray-800">Key Metrics:</h4><p class="text-sm text-gray-600">${estateData.reports.pinfosys.summary}</p><h4 class="font-semibold mt-4 text-gray-800">Expenditure Breakdown:</h4>${expenditureTable}`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
