<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Sungai Rasau - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="../index.html" class="flex items-center">
                    Ladang Sungai Rasau Report
                </a>
            </div>
            <a href="../estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "sgrasau",
                "name": "Ladang Sungai Rasau",
                "reportInfo": "Data based on PA Report 2/2025 (Visit: 20th Nov 2025) & Agronomy Report 2/2025 (Visit: 27th Nov 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 111.00 ha",
                            "Mature: 111.00 ha",
                            "Immature: 0 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "18.40 / 18.26 MT",
                        "note": "YTD Oct 2025 (Source: PAR)"
                    },
                    "cost": {
                        "title": "Cost/Tonne (Actual vs Budget)",
                        "value": "RM 253.84 / RM 299.27",
                        "note": "YTD Oct 2025 (Source: PAR)"
                    },
                    "manuring": {
                        "title": "Manuring Status",
                        "value": "Delayed (Mix B)",
                        "note": "P10C, P05F, P06G Pending"
                    },
                     "pests": {
                        "title": "Pest Status",
                        "value": "Controlled",
                        "note": "Bagworm recovered, Rats <5%"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:22 ha (Harvester)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Controlled" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD Oct)", "value": "19.00%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "2.25 MT/md" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "15 days" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Low N, Mg, B" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan-25", "Feb-25", "Mar-25", "Apr-25", "May-25", "Jun-25", "Jul-25", "Aug-25", "Sep-25", "Oct-25"],
                        "ffb": [193.01, 176.22, 204.11, 211.35, 181.32, 181.50, 184.30, 203.26, 204.31, 303.35],
                        "rainfall": [235, 42, 82, 189, 397, 19, 195, 141, 155, 184],
                        "note": "*2025 Monthly FFB Production vs Rainfall. (Source: PAR 2/2025, Pg. 31, 47)"
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature (11-18Y)", "Old Mature (>19Y)"],
                        "data": [4.1, 95.9],
                        "title": "Ladang Sungai Rasau - Palm Age Distribution",
                        "note": "*Majority of estate (>19Y) planned for replanting starting 2027. (Source: PAR 2/2025 Pg. 9)"
                    }
                },
                "observations": [
                    "<b>Future Replanting Plan:</b> Replanting is scheduled for 2027 covering 58.30 ha in blocks P96A, P98D, and P02E. <span class='observation-ref'>(PAR 2/2025 Pg. 9; AR 2/2025 Pg. 8)</span>",
                    "<b>Manuring Delays:</b> Mixture B application is delayed in P10C, P05F, and P06G. Completion targeted for Nov 2025. <span class='observation-ref'>(PAR 2/2025 Pg. 26; AR 2/2025 Pg. 10)</span>",
                    "<b>Pruning Backlog:</b> Pruning is behind schedule in older plantings (P96A, P98D, P02E). Messy field conditions with hanging dried fronds observed in tall palm areas. <span class='observation-ref'>(PAR 2/2025 Pg. 22)</span>",
                    "<b>Infrastructure Issues:</b> Road grading has not been carried out this year. Soggy stretches require surfacing with crusher run. <span class='observation-ref'>(PAR 2/2025 Pg. 21)</span>",
                    "<b>Weeding Standards:</b> Noxious weeds (wild palms, stenochlaena, brackens) found in open areas, ponds, and boundary fringes require eradication. <span class='observation-ref'>(PAR 2/2025 Pg. 19)</span>",
                    "<b>Nutrient Status:</b> Foliar analysis indicates low Nitrogen (N) and Magnesium (Mg) levels, particularly in P10C, P02E, and P06G. <span class='observation-ref'>(AR 2/2025 Pg. 17)</span>",
                    "<b>Pest Control:</b> Bagworm infestation is controlled with no fresh damage. Rat damage is negligible (<5%). <span class='observation-ref'>(PAR 2/2025 Pg. 25; AR 2/2025 Pg. 24)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance is acceptable. FFB production is 1% higher than budget, and costs are 16% lower. The labour ratio is adequate at 1:22 ha with multi-tasking practiced. Key issues are delayed pruning in tall palms, delayed manuring (Mix B), and lack of road grading. (Source: PAR 2/2025, Pg. 36-37)",
                        "Area Statement": "Total mature planted area is 111.00 ha. Age profile: 95.9% Old Mature (>19 years) and 4.1% Prime Mature. Replanting of 58.3 ha (P96A, P98D, P02E) is proposed for 2027. (Source: PAR 2/2025, Pg. 9)",
                        "Labour Statement": "Total workforce is 9 workers (Req: 10). Harvester strength is adequate (1:22 ha). Productivity is 2.25 tons/man-day. Multi-tasking is implemented to cover upkeep shortages. (Source: PAR 2/2025, Pg. 11)",
                        "Upkeep and Cultivation": "Weeding cost is 27% lower than budget, but noxious weeds persist in open areas. Road grading was not done this year. Pruning is behind schedule in P96A, P98D, and P02E. Manuring (Mix B) is delayed. (Source: PAR 2/2025, Pg. 16-26)",
                        "Crop Production": "YTD Oct FFB production is 2,042.73 MT (1% above budget). Yield per ha is 18.40 MT. Highest yield in P10C (26.60 MT/ha), lowest in P96A (15.45 MT/ha). (Source: PAR 2/2025, Pg. 31-32)",
                        "Cost of Production": "Ex-estate cost is RM 253.84/MT (15% lower than budget). Upkeep cost is 14% higher than budget due to bagworm treatment. Harvesting cost is 4% lower than budget. (Source: PAR 2/2025, Pg. 34)",
                        "Vehicles & Machinery": "Tractor and Timac running costs are within or below budget. Timac productivity is 10.83 tons/day. (Source: PAR 2/2025, Pg. 35)"
                    },
                    "agronomy": {
                        "Executive Summary": "Agronomy visit conducted on 27th Nov 2025. Overall agronomic conditions are satisfactory. Key focuses are the 2027 replanting plan for old mature areas and resolving fertilizer supply delays. (Source: AR 2/2025, Pg. 7)",
                        "Blocking & Replanting Plan": "Replanting of blocks P96A, P98D, and P02E is confirmed for 2027, covering 58.30 hectares (52.52% of total area). It is recommended to withdraw the fertilizer program for these blocks in the upcoming year to prepare for replanting. Current palm density in these old blocks is below 125 SPH. (Source: AR 2/2025, Pg. 8-9)",
                        "Nutrient Inputs/Progress of Manuring": "Overall manuring progress is 80%. Applications of NK1 (47.01MT) and RP (11.30MT) are 100% complete. However, Mixture B application is pending (59% complete) due to supplier stock shortages, small order quantity logistics, and peak crop season constraints. Completion is targeted for mid-Dec 2025. (Source: AR 2/2025, Pg. 10)",
                        "Field Maintenance (Pruning & Weeding)": "<b>Pruning:</b> Progress is satisfactory (100%) in P04B, P05F, P06G, and P10C. However, it is delayed in old plantings (P96A: 52%, P98D: 55%, P02E: 64%) due to harvester shortage and 'supertall' palms (>50ft) that are difficult to reach. <br><b>Weeding:</b> Inter-row weeding is 100% on schedule. Circle weeding is approx. 67% complete. Some regeneration of Ageratum conyzoides and grasses noted in P06G and P05F. (Source: AR 2/2025, Pg. 14, 19)",
                        "Pest & Disease Control": "<b>Rats:</b> Damage census shows infestation is low (<5%) and below economic threshold. Barn owl boxes have 100% occupancy. <br><b>Ganoderma:</b> Census recorded 261 infected palms in P96A and 126 in P98D. Deboling recommended. <br><b>Bagworms:</b> Treated with trunk injection using Impact-75 (Acephate) in Q2/Q3. Damage on young fronds has noticeably reduced. (Source: AR 2/2025, Pg. 24-26)",
                        "Leaf Nutrient Status": "Foliar analysis indicates Nitrogen (N) levels range from deficient to moderately low, particularly in P10C, P02E, and P06G. Magnesium (Mg) is consistently moderately low/deficient. Boron (B) levels fluctuate. Potassium (K) levels are high. (Source: AR 2/2025, Pg. 17)",
                        "Yield Performance": "YTD Oct 2025 yield is 21.39 MT/Ha, a 9.5% decline from 2024. P10C (26.60 MT/Ha) and P06G (22.12 MT/Ha) show decent performance, but P96A (15.45 MT/Ha) is significantly lower (-17.3%) due to palm height constraints limiting harvesting efficiency. (Source: AR 2/2025, Pg. 28)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Management</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-CENSUS-01:</b> Pest censuses for rats and leaf-eating pests must be conducted quarterly to enable early detection and timely intervention.</p></div> <div class='policy-item'><p class='font-semibold'>Infrastructure</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-INFRA-02:</b> Critical infrastructure such as bridges and main outlet drains must be repaired immediately to prevent disruption to field operations and mitigate flooding.</p></div> <div class='policy-item'><p class='font-semibold'>Canopy Management</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-TALL-01:</b> Supertall palms that cannot be safely harvested or pruned should be identified and scheduled for removal/replanting to eliminate safety risks and prevent crop loss.</p></div> <div class='policy-item'><p class='font-semibold'>Weed Management</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-NOXIOUS-01:</b> Areas with persistent noxious weeds (VOPs, Stenochlaena, etc.) must have a targeted eradication plan to prevent spread and impact on palm health.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Manuring') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#eab308', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (agronomyDiv) {
                    agronomyDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (plantationDiv) {
                    plantationDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                } else if (pinfosysDiv) {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = ` <div class='policy-item'><p class='font-semibold'>Pest Management</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-CENSUS-01:</b> Pest censuses for rats and leaf-eating pests must be conducted quarterly to enable early detection and timely intervention.</p></div> <div class='policy-item'><p class='font-semibold'>Infrastructure</p><p class='text-sm text-gray-600'><b>Policy Ref: MAINT-INFRA-02:</b> Critical infrastructure such as bridges and main outlet drains must be repaired immediately to prevent disruption to field operations and mitigate flooding.</p></div> <div class='policy-item'><p class='font-semibold'>Canopy Management</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-TALL-01:</b> Supertall palms that cannot be safely harvested or pruned should be identified and scheduled for removal/replanting to eliminate safety risks and prevent crop loss.</p></div> <div class='policy-item'><p class='font-semibold'>Weed Management</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-NOXIOUS-01:</b> Areas with persistent noxious weeds (VOPs, Stenochlaena, etc.) must have a targeted eradication plan to prevent spread and impact on palm health.</p></div>`;
            modalTitle.innerText = 'Agricultural Policy Cross-Reference: Ladang Sungai Rasau';
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
